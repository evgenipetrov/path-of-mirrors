# Repository Guidelines

## Project Structure & Module Organization
- Core services live in `backend/src/`: domain contexts in `contexts/`, shared infra in `infrastructure/`, API entry in `app/main.py`, Alembic revisions in `backend/alembic/versions/`.
- Frontend lives in `frontend/src/`: routes in `routes/`, shared UI in `components/`, feature code in `features/`, API client generated by `orval`.
- `scripts/` wraps start/test/lint/migration flows; `docs/` holds architecture/roadmap; `_samples/` stores reference payloads.

## Build, Test, and Development Commands
- First-time setup: `./scripts/setup-project.sh` (deps → Docker services → migrations, optional seed).
- Daily dev: `./scripts/start-services.sh --dev` (Postgres, Redis, FastAPI, Vite). Stop with `Ctrl+C` or `./scripts/stop-services.sh`.
- Tests: `./scripts/run-tests.sh` for all; `--backend` runs pytest in Docker; `--frontend` runs vitest; add `--coverage`.
- Lint/format/type-check: `./scripts/check-code.sh --fix` (ruff format/check + mypy; eslint + TS types).
- Migrations: `./scripts/migrate-db.sh create "add feature"` then `./scripts/migrate-db.sh` to upgrade.
- Regenerate API client: `./scripts/generate-api.sh` after backend schema changes.

## Coding Style & Naming Conventions
- Python: 4-space indent, type hints; prefer dataclass-style models; modules snake_case; `check-code.sh` runs ruff format/check + mypy.
- TypeScript/React: components/hooks PascalCase; hooks start `use`; tests `*.test.ts[x]`; Tailwind classes stay readable. ESLint + Prettier guard style.
- Scripts: keep filenames `verb-noun.sh` (e.g., `start-services.sh`, `build-images.sh`) for clarity; consistency across scripts is paramount—reuse shared helpers in `scripts/lib` instead of duplicating logic.
- Env: copy `backend/src/.env.example` to `backend/src/.env`; never commit secrets.

## Testing Guidelines
- Backend tests in `backend/tests/`; keep coverage ≥70%. Name files `test_*.py`; lean on fixtures.
- Frontend unit tests use Vitest (`frontend/vitest.config.ts`); e2e lives in `frontend/e2e/` with Playwright—run when touching navigation/auth.
- Expectation: `./scripts/run-tests.sh` passes locally; add `--coverage` for riskier edits.

## Commit & Pull Request Guidelines
- Use Conventional Commits (`feat|fix|chore|docs|test`: summary) as in git history; keep scope small.
- Before PR: run `./scripts/check-code.sh --fix` and `./scripts/run-tests.sh`; call out skipped checks.
- PR description: summary, tests run, linked issue, screenshots/GIFs for UI work, migration/backfill notes if applicable.
- Keep changes focused; draft PRs welcome for feedback.

## Security & Operations Notes
- Config via `.env` or compose overrides only; no hardcoded tokens.
- Health checks: `GET /health` and `GET /ready` on :8000—verify after compose tweaks.
- For data fixes, add small scripts in `backend/scripts/` and record run commands in the PR.

## Agent Role (Codex)
- You are a mentor/QA/verifier only. Do **not** implement features or commit changes; your job is to critique plans, check adherence to standards, and flag risks.
- Priorities: (1) correctness and safety, (2) alignment with documented standards, (3) maintainability and parity between code, tests, and docs.
- Always demand evidence: ask for tests, logs, diffs, or commands run before accepting claims. Never trust implementer reports—verify with your own inspection.
- When unsure or claims conflict with the repository state, verify by inspecting code/tests; do not assume. You are allowed to run any tests needed to validate.
- Keep feedback concise, objective, and actionable; prefer checklists and clear next steps over vague advice.
- You own final gatekeeping: after validation you are responsible for the final git commits and pushes. Do so only when standards are met and evidence (tests/logs/diffs) supports the change.
